<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="NovelWriter - An agentic AI-powered novel writing application">
  <title>NovelWriter</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/src/styles/main.css">
</head>

<body>
  <div id="app">
    <!-- Top Bar -->
    <header class="top-bar">
      <div class="top-bar-left">
        <button class="icon-btn" id="btn-reading-mode" title="Reading Mode">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
          </svg>
        </button>
        <span class="app-title">NovelWriter</span>
      </div>
      <div class="top-bar-center">
        <span class="project-title" id="project-title">Untitled Book</span>
      </div>
      <div class="top-bar-right">
        <button class="icon-btn" id="btn-thesaurus" title="Thesaurus">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" />
            <path d="M8 7h8M8 11h8M8 15h4" />
          </svg>
        </button>
        <button class="icon-btn" id="btn-open-project" title="Open Project">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
          </svg>
        </button>
        <button class="icon-btn" id="btn-save-project" title="Save Project">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
            <polyline points="17,21 17,13 7,13 7,21" />
            <polyline points="7,3 7,8 15,8" />
          </svg>
        </button>
        <button class="icon-btn" id="btn-new-project" title="New Project">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14,2 14,8 20,8" />
            <line x1="12" y1="18" x2="12" y2="12" />
            <line x1="9" y1="15" x2="15" y2="15" />
          </svg>
        </button>
        <button class="icon-btn" id="btn-api-config" title="API Configuration">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path
              d="M12 2v6m0 8v6M4.93 4.93l4.24 4.24m5.66 5.66l4.24 4.24M2 12h6m8 0h6M4.93 19.07l4.24-4.24m5.66-5.66l4.24-4.24" />
          </svg>
        </button>
        <button class="icon-btn" id="btn-settings" title="Settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3" />
            <path
              d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
          </svg>
        </button>
        <button class="icon-btn" id="btn-theme" title="Toggle Theme">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5" />
            <line x1="12" y1="1" x2="12" y2="3" />
            <line x1="12" y1="21" x2="12" y2="23" />
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
            <line x1="1" y1="12" x2="3" y2="12" />
            <line x1="21" y1="12" x2="23" y2="12" />
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
          </svg>
        </button>
      </div>
    </header>

    <!-- Main Layout -->
    <main class="main-layout">
      <!-- Left Sidebar - Navigation Tree -->
      <aside class="sidebar sidebar-left" id="sidebar-left">
        <div class="sidebar-header">
          <input type="text" class="search-input" placeholder="Filter project files..." id="filter-input">
        </div>

        <nav class="tree-nav" id="tree-nav">
          <!-- Tree navigation will be injected here -->
        </nav>
      </aside>

      <!-- Center - Editor Area -->
      <section class="editor-area" id="editor-area">
        <!-- Toolbar -->
        <div class="editor-toolbar" id="editor-toolbar">
          <div class="toolbar-group">
            <button class="toolbar-btn" id="btn-bold" title="Bold (Ctrl+B)">
              <strong>B</strong>
            </button>
            <button class="toolbar-btn" id="btn-italic" title="Italic (Ctrl+I)">
              <em>I</em>
            </button>
            <button class="toolbar-btn" id="btn-underline" title="Underline (Ctrl+U)">
              <u>U</u>
            </button>
          </div>
          <div class="toolbar-divider"></div>
          <div class="toolbar-group">
            <select class="toolbar-select" id="font-family">
              <option value="Merriweather">Merriweather</option>
              <option value="Georgia">Georgia</option>
              <option value="Times New Roman">Times New Roman</option>
              <option value="Arial">Arial</option>
              <option value="Inter">Inter</option>
              <option value="Courier New">Courier New</option>
            </select>
            <select class="toolbar-select" id="font-size">
              <option value="8">8px</option>
              <option value="10">10px</option>
              <option value="12">12px</option>
              <option value="14">14px</option>
              <option value="16" selected>16px</option>
              <option value="18">18px</option>
              <option value="20">20px</option>
              <option value="24">24px</option>
              <option value="28">28px</option>
            </select>
          </div>
        </div>

        <!-- Editor Content -->
        <div class="editor-content-wrapper">
          <div class="editor-page">
            <div class="editor-content" id="editor-content" contenteditable="true" spellcheck="true">
            </div>
          </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
          <span class="status-item" id="word-count">0 words</span>
          <span class="status-divider">|</span>
          <span class="status-item" id="save-status">Saved</span>
        </div>
      </section>

      <!-- Right Sidebar - AI Agent Panel -->
      <aside class="agent-panel collapsed" id="agent-panel">
        <div class="agent-content">
          <div class="agent-header">
            <div class="agent-title">
              <span class="agent-status" id="agent-status"></span>
              <span>AI Agent</span>
            </div>
            <select class="agent-mode-select" id="agent-mode-select">
              <option value="auto">Auto</option>
              <option value="quick">Quick</option>
              <option value="planning">Planning</option>
              <option value="chatty">Chatty</option>
            </select>
          </div>
          <div class="agent-conversations-bar">
            <button class="btn btn-sm" id="agent-new-conversation" title="New Conversation">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
              </svg>
              New
            </button>
            <select class="agent-conversation-select" id="agent-conversation-select" title="Switch Conversation">
              <option value="">No conversations yet</option>
            </select>
            <button class="icon-btn btn-sm" id="agent-delete-conversation" title="Delete Current Conversation">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6" />
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
              </svg>
            </button>
          </div>
          <div class="agent-history" id="agent-history">
            <div class="agent-message system">
              <div class="message-content">ðŸ‘‹ I'm your AI writing assistant. Ask me anything about your story, request
                edits, or just chat about your plot!</div>
            </div>
          </div>
          <div class="agent-input-area">
            <textarea id="agent-input" placeholder="Ask the AI agent..." rows="2"></textarea>
            <button class="btn btn-primary" id="agent-send-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13" />
                <polygon points="22 2 15 22 11 13 2 9 22 2" />
              </svg>
            </button>
          </div>
        </div>
      </aside>

      <!-- AI Agent Drawer Tab (positioned after panel for CSS sibling selector) -->
      <div class="agent-drawer-tab" id="agent-drawer-tab" title="Toggle AI Agent">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6" />
        </svg>
      </div>
    </main>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2>Settings</h2>
          <button class="icon-btn" id="close-settings">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="settings-section">
            <h3>Appearance</h3>
            <div class="setting-row">
              <label>Theme</label>
              <select id="setting-theme">
                <option value="light">Light</option>
                <option value="dark">Dark</option>
              </select>
            </div>
            <div class="setting-row">
              <label>Editor Font</label>
              <select id="setting-font">
                <option value="Merriweather">Merriweather</option>
                <option value="Georgia">Georgia</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Arial">Arial</option>
              </select>
            </div>

            <h3>AI Configuration</h3>
            <div class="setting-row">
              <label>Context Strategy</label>
              <select id="setting-ai-context-strategy">
                <option value="smart">Smart (Efficient)</option>
                <option value="full">Full Manuscript (High Cost)</option>
              </select>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="save-settings">Save Settings</button>
        </div>
      </div>
    </div>

    <!-- API Configuration Modal -->
    <div class="modal" id="api-config-modal">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2>API Configuration</h2>
          <button class="modal-close" id="close-api-config">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="settings-section">
            <p class="settings-description">Configure your AI provider connection. Works with any OpenAI-compatible API.
            </p>
            <div class="setting-row">
              <label>Provider URL</label>
              <input type="text" id="setting-ai-provider" placeholder="e.g., https://api.nano-gpt.com/v1" />
            </div>
            <div class="setting-row">
              <label>API Key</label>
              <div class="api-key-input">
                <input type="password" id="setting-ai-apikey" placeholder="Enter your API key" />
                <button type="button" class="btn-icon" id="toggle-apikey-visibility" title="Show/Hide">
                  <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" fill="none">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                    <circle cx="12" cy="12" r="3" />
                  </svg>
                </button>
              </div>
            </div>

            <div class="setting-row">
              <label>Model ID</label>
              <input type="text" id="setting-ai-model" placeholder="e.g., glm-4.7, gpt-4o, claude-3-5-sonnet" />
            </div>
            <div class="setting-row setting-row-actions">
              <button type="button" class="btn btn-secondary" id="test-ai-connection">Test Connection</button>
              <span id="ai-connection-status"></span>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" id="save-api-config">Save Configuration</button>
        </div>
      </div>
    </div>

    <!-- Reading Mode Modal -->
    <div class="reading-modal" id="reading-modal">
      <div class="reading-modal-header">
        <button class="icon-btn" id="close-reading">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
        <span id="reading-title">Reading Mode</span>
      </div>
      <div class="reading-content" id="reading-content">
        <!-- Reading content injected here -->
      </div>
    </div>

    <!-- Hidden file input for opening projects -->
    <input type="file" id="file-input" accept=".json" style="display: none;">

    <!-- Diff Preview Modal -->
    <div class="modal" id="diff-preview-modal">
      <div class="modal-backdrop"></div>
      <div class="diff-modal-content">
        <div class="diff-header">
          <h3>Preview Changes</h3>
          <button class="icon-btn close-modal">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="diff-body" id="diff-body">
          <!-- Diff content rendered here -->
        </div>
        <div class="diff-actions">
          <button class="btn btn-secondary" id="diff-cancel">Cancel</button>
          <button class="btn btn-primary" id="diff-apply">Apply Changes</button>
        </div>
      </div>
    </div>

    <!-- Selection Toolbar (no longer used, kept for potential future features) -->
    <div id="selection-toolbar" class="selection-toolbar">
    </div>

    <!-- Project Selector Modal -->
    <div class="modal" id="projects-modal">
      <div class="modal-backdrop" id="projects-backdrop"></div>
      <div class="modal-content modal-content-wide">
        <div class="modal-header">
          <h2>Your Projects</h2>
          <button class="icon-btn" id="close-projects">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="projects-list" id="projects-list">
            <!-- Projects will be listed here -->
          </div>
          <div class="projects-actions">
            <button class="btn btn-secondary" id="import-project-btn">Import from File</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Thesaurus Modal -->
    <div class="modal" id="thesaurus-modal">
      <div class="modal-backdrop" id="thesaurus-backdrop"></div>
      <div class="modal-content thesaurus-modal">
        <div class="modal-header">
          <h2>ðŸ“– Thesaurus</h2>
          <button class="icon-btn" id="close-thesaurus">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <div class="modal-body">
          <div class="thesaurus-search-row">
            <input type="text" id="thesaurus-input" placeholder="Enter a word..." autocomplete="off" />
            <button class="btn btn-primary" id="thesaurus-search-btn">Search</button>
          </div>
          <div class="thesaurus-toggle">
            <button class="toggle-btn active" id="toggle-synonyms">Synonyms</button>
            <button class="toggle-btn" id="toggle-antonyms">Antonyms</button>
          </div>
          <div class="thesaurus-results" id="thesaurus-results">
            <p class="thesaurus-hint">Enter a word and press Search to find synonyms or antonyms.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>

</html>